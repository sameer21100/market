{%extends "parent.html"%}
{%block title%}Market{%endblock%}
{%block content%}
<div class="container">
  <style>
    td {
      word-break: break-word;
      overflow-wrap: break-word;
    }
    .promotion-section {
      border: 2px solid #ccc;
      border-radius: 20px;
      padding: 20px;
      background-color: #1e1e2f;
      margin-bottom: 20px;
    }

    .promotion-heading {
      text-align: center;
      margin-top: 0;
      margin-bottom: 20px;
      color: white;
      font-size: 2rem;
    }

    .promotion-cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 30px;
      margin-top: 20px;
    }

    .promo-card {
      width: 230px;
      margin: 10px;
      background-color: #2c2c3e;
      border-radius: 15px;
      padding: 15px;
      margin: 10px 0;
      transition: border 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
      position: relative;
      overflow: hidden;
      border: 2px solid transparent;
    }

    .promo-card:hover {
      animation: pulse-border 2s infinite linear;
      border: 2px solid #8000ff;
    }

    @keyframes pulse-border {
      0% {
        box-shadow: 0 0 0 0 rgba(128, 0, 255, 0.7);
      }
      50% {
        box-shadow: 0 0 15px 5px rgba(128, 0, 255, 0.5);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(128, 0, 255, 0.7);
      }
    }

    @media (max-width: 768px) {
      .promo-card {
        width: 90%;
      }

      .promotion-container {
        padding: 20px;
      }
    }
  </style>
  <div class="row col-12 promotion-section">
    <h2 class="promotion-heading">Promoted products</h2>
    <div class="promotion-cards">
      {% for item in promoted %}
      <div class="promo-card">
        <h4 class="text-white">{{ item["name"] }}</h4>
        <p class="text-white">Price: ₹{{ item["price"] }}</p>
        {% if session['id'] == item['owner_id'] %}
        <form method="POST" action="/delete/{{ item['id'] }}" style="display:inline;">
          <input type="hidden" name="form_type" value="depromo">
          <button type="submit" class="btn btn-danger"
            onclick="return confirm('Are you sure you want to delete this item?');">Remove</button>
        </form>
        <p class="text-white"><strong>Time Left:</strong> {{ item['time_remaining'] }}</p>
        {% endif %}
      </div>
      {% endfor %}
    </div>
  </div>




  <div class="row">
    <div class="col-12">
      <h3>
        Available items on the market
      </h3>
      <div class="table-responsive">
        <table class="table table-hover table-dark" style="width: 100%; table-layout: fixed; word-wrap: break-word;">
          <thead>
            <tr>
              <!-- <th scope="col">ID</th> -->
              <th scope="col">Name</th>
              <!-- <th scope="col">Barcode</th> -->
              <th scope="col">Price</th>
              <th> Options</th>
            </tr>
          </thead>
          <tbody>
            {%for item in objects%}
            <tr>
              <!-- <td>{{item["id"]}}</td> -->
              <!-- <td>{{item["id"]}}</td> -->
              <td>{{item["name"]}}</td>
              <!-- <td>{{item["barcode"]}}</td> -->
              <td>₹{{item["price"]}}</td>
              <!-- Desktop/Tablet View -->
              <td class="d-none d-md-block">
                <button class="btn btn-outline btn-info" data-toggle="modal" data-target="#modal-{{item['id']}}">More info</button>
                <form action="/reduce/50/{{item['owner_id']}}" method="POST" style="display:inline">
                  <input type="hidden" name="form_type" value="pay">
                  <button class=" btn btn-outline btn-success" style="display: inline;"
                    onclick="return confirm('This will take 50 credits from your account!!');">
                     Contact seller
                  </button>
                </form>
                {%if session['id']==item['owner_id']%}
                <form method="POST" action="/delete/{{item['id']}}" style="display:inline;">
                  <input type="hidden" name="form_type" value="delete">
                  <button type="submit" class="btn btn-danger"
                    onclick="return confirm('Are you sure you want to delete this item?');">Delete</button>
                </form>
               
                {%endif%}
              </td>
              <!-- Mobile View -->
              <td class="d-block d-md-none">
                <div class="mt-2">
                  <button class="btn btn-outline btn-info btn-block mb-1" data-toggle="modal" data-target="#modal-{{item['id']}}">More info</button>
                  <form action="/reduce/50/{{item['owner_id']}}" method="POST">
                    <input type="hidden" name="form_type" value="pay">
                    <button class="btn btn-outline btn-success btn-block mb-1"
                      onclick="return confirm('This will take 50 credits from your account!!');">
                      Contact seller
                    </button>
                  </form>
                  {%if session['id']==item['owner_id']%}
                  <form method="POST" action="/delete/{{item['id']}}">
                    <input type="hidden" name="form_type" value="delete">
                    <button type="submit" class="btn btn-danger btn-block"
                      onclick="return confirm('Are you sure you want to delete this item?');">Delete</button>
                  </form>
                  {%endif%}
                </div>
              </td>
            </tr>
            <div class="modal fade" id="modal-{{item['id']}}" tabindex="-1" role="dialog"
              aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" style="color:black" id="exampleModalLongTitle">Description</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    
                    <h5 style="color:black">{{item["name"]}}</h5>
                    <p style="color:black">{{item["description"]}}</p>
                   {% if session['id']==item['owner_id']%}
                    <form action="/promote/50/{{item['owner_id']}}/{{item['id']}}" method="POST">
                      <input type="hidden" name="form_type" value="promote">
                      <button class="btn btn-danger" type="submit" 
                      onclick="return confirm('Do you want to promote this item')">Promote for ₹50</button>
    
                    </form>
                    {%endif%}
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                  </div>
                </div>
              </div>
            </div>
            {%endfor%}
          </tbody>
        </table>
      </div>
    </div>
    <div class="col-4">

      <h3> Your items</h3>
      <!-- {% if objects|length == 0 %}
      <h4 >No items found. Add some items to get started!</h4>
    {% endif %} -->
          {%for item in objects%}
            {% if item['owner_id']==session['id']%}
            
              <div class ="row">
              <div class="col-5">
              {{item['name']}}
            </div>
              {{item['price']}}
            </div>
            <br>
            
            
              {%endif%}
          {%endfor%}
    </div>
    <!-- Your page content here -->

    <!-- Modal goes at the end -->
    <!-- Modal -->
  </div>
</div>
{%endblock%}